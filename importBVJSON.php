<?php

require('vendor/autoload.php');
require('config.php');
require('helpers.php');
require('bvprocessor.php');
set_time_limit(0);

function importJSON() {
    global $retry_count;
    $test_mode = false;
    
    if(isset($_GET['mode']) && $_GET['mode'] == 'test'){
        $test_mode = true;
    }





$records = [3659,2545,5408,5513,5682,5739,7468,8881,8912,4662,8644,9346,10252,10437,10657,10706,11445,11771,12157,12207,13820,15052,15381,16725,17171,18492,18606,18778,18815,18894,18977,18906,19138,19187,19561,19534,19901,19819,19956,20307,20468,20598,21450,21737,21804,16127,22749,22285,23065,23016,24550,25262,25173,24007,25365,26102,25100,26527,26913,27201,27858,27851,27962,28317,28488,28582,28846,28813,29925,30046,29858,30674,30852,30820,31161,29487,31642,31276,28415,31920,32339,32368,32448,31888,33532,33879,34230,35157,35105,35650,35668,35706,35926,30967,29820,34744,39364,39456,40002,39718,40967,38175,41387,40394,41578,41724,41513,41829,41390,41929,42195,38747,42660,42343,43242,43344,43840,44127,44546,44466,44440,45095,45554,43695,42871,45364,45657,46303,44856,41872,47159,47086,47267,47349,47689,49567,49518,50101,50591,50760,50906,51341,51541,52503,52516,52545,53611,54241,49081,55041,53545,54665,56319,56472,57209,57288,57494,56234,56595,58187,57349,57823,59698,59891,60112,60074,60549,60632,60762,48926,61063,61832,62224,62336,62649,61405,63268,63483,64338,64121,65227,65622,64539,66200,66714,66801,66878,55565,67692,68218,68215,68366,69157,69903,70587,69554,69725,71106,71190,70986,70867,68709,72624,70723,67167,70973,74108,73994,42663,48651,74950,75840,75437,77237,75881,77513,75894,78974,79287,75887,81212,79394,81497,81702,74589,77841,74583,81744,81935,82061,82099,79522,81826,81831,82529,82817,83800,83936,81969,82857,84640,84966,84177,85010,85905,86018,86180,85971,86772,85936,87085,85569,85918,85591,87221,86777,86469,87177,87272,88106,88150,87064,88335,88228,89051,87438,88159,85655,89054,89836,89040,89392,89600,90640,90861,89559,90977,88133,91501,92288,92311,92583,92378,92600,92775,93352,92700,91888,93645,93331,93975,93547,94025,93438,93059,94159,94146,94307,93055,94145,94020,95126,94284,94350,93799,92770,93127,95350,96421,96786,96621,96828,96985,96206,96110,97415,97273,55734,97938,97897,98271,97288,97632,97659,97305,94319,96687,98259,99113,99239,99281,99310,99612,99872,100289,100109,101602,68981,102173,99888,71178,102177,102756,103248,103492,103499,102546,103974,103565,103859,103819,104586,103426,103417,104651,104843,105080,105813,105821,100552,71261,90196,83065,74718,102694,105820,105715,105645,106000,106542,106567,106733,107119,106777,107858,107215,106909,104751,107928,108325,107126,108583,108701,108760,108991,108462,108702,103778,107904,109325,107919,108107,107899,107626,106058,109521,109514,109295,109711,109894,108874,109899,109660,110438,110604,110760,110808,107922,110295,110545,110610,110842,110697,110302,107778,111330,111408,111419,111479,111528,111587,111673,107631,111787,111854,108869,111962,110418,112080,112142,112244,112304,112134,112636,109748,112727,112892,107435,113161,113650,113964,114108,114032,113234,114185,114327,114390,114622,114686,115061,115055,115151,114804,115395,115543,115547,115626,115710,115542,115893,115406,115865,115959,116265,116305,116195,116743,116880,116946,117082,117313,117568,56846,22423,118187,49968,50009,21995,118504,118537,118592,118650,118909,56961,119343,119365,114976,119503,119707,119965,119521,119972,120151,120250,120278,100667,120657,46544,120578,121156,121115,121232,37403,121189,121288,121777,121802,121800,121836,121905,121966,122236,122068,122284,122283,122322,122020,122657,122838,122519,122374,122526,122915,122977,121973,121977,123221,123340,123495,124319,123489,124327,124515,120439,124670,125082,125006,125324,125396,118523,125626,125716,125771,125933,125990,126220,126541,126699,126737,126830,126865,127274,126674,127437,127521,127774,127811,127959,128035,128077,128202,128310,127933,128450,128519,128648,128560,128866,129178,129317,129393,129268,129886,130199,78766,130650,130908,114292,131032,131661,131700,131771,132137,132333,130796,132784,132845,132855,131564,133100,133157,133275,133256,133675,133388,133970,129094,133506,133305,81650,134439,134433,134643,134201,134331,134899,134929,134807,135096,135593,135706,135661,135763,135816,135894,135957,135998,136118,136186,136231,136465,136801,135390,136965,137234,137586,137534,137685,137749,137323,138072,138314,138401,138389,115583,138405,138758,138806,139041,139102,139540,139765,139847,139938,140756,140856,140981,141061,138690,141652,141736,142029,142046,142067,142116,142377,142451,142542,142689,142720,142783,142862,142957,142973,143160,143218,143274,143217,142662,143830,143877,144054,144368,144651,144758,144887,145045,145484,145645,145557,145912,145966,146423,146522,146412,146639,146580,146806,146988,146950,147222,147059,147305,147386,146940,147193,147772,147793,147299,143320,148354,148361,148412,148460,148858,148701,142178,149204,147896,149472,149487,149603,33463,149193,149913,150215,150515,150889,151276,151315,151250,151483,151553,151816,152106,151936,152257,112586,152664,125512];

// $records = [125006];






    foreach ($records as $record) {
        $msg = '';

        $url = "https://beauty.vogue.it/wp-json/posts/".$record;

      
        $data = fetchJsonFromUrl($url);
        $jsonData = $data;
        if (true){

        $processor = new Processor();
        $processor->data = $jsonData;

        $result = $processor->processData();
        $data = $result;
        if (isset($data['inline'])) {
            $inlineValue = $data['inline'];
            unset($data['inline']);
        } else {
            $inlineValue = null;
        }

        $newData = [];
        foreach ($data as $key => $value) {
            // When we reach the "body" key, insert the "inline" field first.
            if ($key === 'body' && $inlineValue !== null) {
                $newData['inline'] = $inlineValue;
            }
            // Then insert the current field.
            $newData[$key] = $value;
        }

        if(!$test_mode){
            $folderpath = "BEAUTY_VOGUE_JSON_FILES/new_jsons/";
            $filePath = $folderpath.'beautyvogue_'.$record.'.json';
            if (!file_exists($folderpath)) {
                mkdir($folderpath, 0777, true);
            }


            $jsonData = json_encode($newData, JSON_PRETTY_PRINT);

            if ($jsonData === false) {
                die('Error encoding JSON: ' . json_last_error_msg());
            }

            if (file_put_contents($filePath, $jsonData)) {
                $msg .= $record.' json created ';
      
            
        } else {
            echo "Error writing JSON data to file.";
        }
        $msg .= '</br>';
        echo $msg;
    }else {
        echo "<div>==============================================================================</div>";
        echo json_encode($result, JSON_PRETTY_PRINT);
        echo "<div>==============================================================================</div>";
    }
}   
    }
   
}

$result = importJSON();
